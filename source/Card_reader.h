//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//	@file		Card_reader.h									//
//	@brief		Driver for usage of the card reader 			//
//	@author		Grupo	4										//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

#ifndef _CARD_READER_H_
#define _CARD_READER_H_

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//							Headers								//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

#include <stdint.h>
#include <stdbool.h>

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//		CONSTANT AND MACRO DEFINITIONS USING #DEFINE 		 	//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//			ENUMERATIONS AND STRUCTURES AND TYPEDEFS			//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

typedef void (*card_callback_t)(void);

typedef struct{
	uint64_t pan;
	uint16_t service_code;
	uint16_t PVV;
	uint16_t CVV;
    uint8_t exp_year;
	uint8_t exp_month;
    uint8_t PVKI;
	bool everything_ok;
}card_t;

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//			FUNCTION PROTOTYPES WITH GLOBAL SCOPE				//
//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

void card_init(void);
/*****************************************************************
 * @brief: Initializer the card reader driver and its components
 ****************************************************************/

bool card_was_read(void);
/*****************************************************************
 * @brief: Function for event generator
 * @return: true if a card was read and the system is ready to
 * 			return its data (must call get_data()), false otherwise.
 ****************************************************************/

card_t card_get_data(void);
/*****************************************************************
 * @brief: When the callback is called, one must obtain the data read
 * 			by the driver, so this function returns the card data.
 * @return: A struct card_t containing the information readed in the card.
 ****************************************************************/

void card_data_read(void);

#endif	//_CARD_READER_H_
